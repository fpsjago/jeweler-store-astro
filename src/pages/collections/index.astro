---
import { getImage } from 'astro:assets';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProductCard from '../../components/ProductCard.astro';
import { products, categories } from '../../data/products';

import diamondRing1 from '../../assets/diamond-ring-1.jpg';
import pearlEarrings1 from '../../assets/pearl-earrings-1.jpg';
import goldBracelet1 from '../../assets/gold-bracelet-1.jpg';
import emeraldRing1 from '../../assets/emerald-ring-1.jpg';
import sapphireRing1 from '../../assets/sapphire-ring-1.jpg';
import weddingRings1 from '../../assets/wedding-rings-1.jpg';
import goldNecklace1 from '../../assets/gold-necklace-1.jpg';
import diamondRing2 from '../../assets/diamond-ring-2.jpg';
import goldPendant1 from '../../assets/gold-pendant-1.jpg';
import luxuryWatch1 from '../../assets/luxury-watch-1.jpg';
import goldNecklace2 from '../../assets/gold-necklace-2.jpg';
import rubyRing1 from '../../assets/ruby-ring-1.jpg';
import topazRing1 from '../../assets/topaz-ring-1.jpg';
import diamondBracelet1 from '../../assets/diamond-bracelet-1.jpg';
import jewelryWorkshop1 from '../../assets/jewelry-workshop-1.jpg';

const productImages = [
  diamondRing1, pearlEarrings1, goldBracelet1, emeraldRing1, sapphireRing1,
  weddingRings1, goldNecklace1, diamondRing2, goldPendant1, luxuryWatch1,
  goldNecklace2, rubyRing1, topazRing1, diamondBracelet1, jewelryWorkshop1
];

const optimizedProducts = await Promise.all(
  productImages.map(img => getImage({ 
    src: img, 
    format: 'webp', 
    width: 600, 
    height: 400 
  }))
);
---

<BaseLayout title="Collections - MAISON">
  <section class="page-header" transition:animate="slide">
    <div class="container">
      <h1>Our Collections</h1>
      <p>Discover exquisite pieces crafted for life's most precious moments</p>
    </div>
  </section>

  <section class="collections">
    <div class="container">
      <div class="filter-bar">
        <button class="filter-btn active" data-category="All">All</button>
        {categories.filter(c => c !== 'All').map(category => (
          <button class="filter-btn" data-category={category}>{category}</button>
        ))}
      </div>

      <div class="product-grid">
        {products.map((product, index) => (
          <ProductCard 
            {...product} 
            imageSrc={optimizedProducts[index].src}
            imageWidth={optimizedProducts[index].attributes.width}
            imageHeight={optimizedProducts[index].attributes.height}
          />
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .page-header {
    background-color: white;
    padding: var(--spacing-xl) 0;
    text-align: center;
    border-bottom: 1px solid rgba(10, 10, 10, 0.1);
  }
  
  .container {
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
  }
  
  .page-header h1 {
    margin-bottom: var(--spacing-sm);
  }
  
  .page-header p {
    font-size: 1.1rem;
    color: var(--warm-gray);
  }
  
  .collections {
    padding: var(--spacing-xl) 0;
  }
  
  .filter-bar {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
    justify-content: center;
    margin-bottom: var(--spacing-xl);
  }
  
  .filter-btn {
    padding: var(--spacing-xs) var(--spacing-md);
    background-color: white;
    color: var(--black);
    border: 1px solid rgba(10, 10, 10, 0.2);
    border-radius: 2px;
    font-size: 0.95rem;
    letter-spacing: 0.05em;
  }
  
  .filter-btn:hover {
    border-color: var(--gold);
    color: var(--gold);
  }
  
  .filter-btn.active {
    background-color: var(--black);
    color: var(--cream);
    border-color: var(--black);
  }
  
  .product-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-lg);
  }
  
  @media (max-width: 768px) {
    .container {
      padding: 0 var(--spacing-md);
    }
    
    .product-grid {
      grid-template-columns: 1fr;
      gap: var(--spacing-md);
    }
    
    .filter-bar {
      gap: var(--spacing-xs);
    }
    
    .filter-btn {
      font-size: 0.85rem;
      padding: var(--spacing-xs) var(--spacing-sm);
    }
  }
  
  @media (min-width: 769px) and (max-width: 1024px) {
    .product-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>

<script>
  // Client-side filtering
  const filterButtons = document.querySelectorAll('.filter-btn');
  const productCards = document.querySelectorAll<HTMLElement>('.product-card');
  
  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const category = button.getAttribute('data-category');
      
      // Update active state
      filterButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      
      // Filter products
      productCards.forEach(card => {
        const productCategory = card.querySelector('.category')?.textContent;
        
        if (category === 'All' || productCategory === category) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });
</script>
