---
import Base from '../layouts/Base.astro';
import ProductCard from '../components/ProductCard.astro';
import { products, categories } from '../data/products';
---

<Base title="Collections" currentPage="/collections">
  <section class="collections-hero">
    <div class="container">
      <h1>Our Collections</h1>
      <p>Explore our curated selection of luxury jewelry</p>
    </div>
  </section>

  <section class="container collections-body">
    <div class="filters-bar" id="filters">
      <button class="filter-btn active" data-filter="all">All</button>
      {categories.map(cat => (
        <button class="filter-btn" data-filter={cat.value}>{cat.label}</button>
      ))}
    </div>

    <p class="results-info">Showing <strong id="product-count">{products.length}</strong> pieces</p>

    <div class="products-grid" id="products-grid">
      {products.map(product => (
        <div data-category={product.category}>
          <ProductCard product={product} />
        </div>
      ))}
    </div>
  </section>
</Base>

<style>
  .collections-hero { padding: var(--space-3xl) 0 var(--space-xl); text-align: center; background: var(--color-bg-alt); }
  .collections-hero h1 { font-size: clamp(2rem, 4vw, 3rem); margin-bottom: var(--space-sm); }
  .collections-hero p { color: var(--color-text-muted); }
  .collections-body { padding-top: var(--space-md); padding-bottom: var(--space-4xl); }
  .filters-bar { display: flex; flex-wrap: wrap; gap: var(--space-sm); padding: var(--space-lg) 0; border-bottom: 1px solid var(--color-border-light); margin-bottom: var(--space-xl); }
  .filter-btn {
    padding: 8px 20px; border: 1px solid var(--color-border); border-radius: 100px;
    font-size: 0.8rem; font-weight: 500; color: var(--color-text-muted);
    background: var(--color-surface); cursor: pointer; transition: all 200ms ease;
  }
  .filter-btn:hover, .filter-btn.active { border-color: var(--color-accent); color: var(--color-accent); background: var(--color-accent-light); }
  .results-info { color: var(--color-text-muted); font-size: 0.85rem; margin-bottom: var(--space-lg); }
  .products-grid { display: grid; grid-template-columns: 1fr; gap: var(--space-lg); }
  @media (min-width: 540px) { .products-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (min-width: 900px) { .products-grid { grid-template-columns: repeat(3, 1fr); } }
  @media (min-width: 1100px) { .products-grid { grid-template-columns: repeat(4, 1fr); } }
</style>

<script>
  const filters = document.getElementById('filters');
  const grid = document.getElementById('products-grid');
  const countEl = document.getElementById('product-count');
  filters?.addEventListener('click', (e) => {
    const btn = (e.target as HTMLElement).closest('.filter-btn') as HTMLElement;
    if (!btn) return;
    filters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const filter = btn.dataset.filter;
    let visible = 0;
    grid?.querySelectorAll('[data-category]').forEach((el) => {
      const item = el as HTMLElement;
      const show = filter === 'all' || item.dataset.category === filter;
      item.style.display = show ? '' : 'none';
      if (show) visible++;
    });
    if (countEl) countEl.textContent = String(visible);
  });
</script>
